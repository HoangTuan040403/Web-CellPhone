@using Doanphanmem.Models
@model List<MatHangMua>
@{
    ViewBag.Title = "HienThiGioHang";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var db = new QL_CHDTEntities();
}

@*kiểm tra không nhập số lượng trong giỏ hàng*@
<!--<script>
    function validateAndUpdateCart() {
        var soLuong = document.getElementById("SoLuong").value;
        if (soLuong < 1) {
            alert("Số lượng không hợp lệ. Vui lòng nhập một số lớn hơn 0.");
            return false;
        }
        return true;
    }
</script>
<h2 style="text-align:center">THÔNG TIN GIỎ HÀNG</h2>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Tên sản phẩm</th>
            <th>Ảnh bìa</th>
            <th>Số lượng</th>
            <th>Đơn giá</th>
            <th>Thành tiền</th>
            <th>Chi tiết</th>
            <th>Cập nhật</th>
            <th>Xóa</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var sach in Model)
        {
            var cus = db.SanPhams.Where(s => s.MaSP == sach.MaDT).Select(s => s.TenSP).FirstOrDefault();

            <tr>
                <td>@cus</td>
                <td><img src="~/Image/@sach.AnhBia" style="width:100%" /></td>
                @using (Html.BeginForm("UpdateCart", "GioHang", new
                {
                    MaSP =
                sach.MaDT
                }))
                {
                    <td>
                        <input type="number" min="1" value="@sach.Soluong" name="SoLuong" id="SoLuong" />
                    </td>

                    <td>@sach.Dongia</td>
                    <td>@sach.Total()</td>
                    <td>
                        @Html.ActionLink("Chi tiết", "Details", "SanPhams", new
                        {
                            id =
                sach.MaDT
                        }, new { @class = "btn btn-success" })
                    </td>
                    <td>
                        <button type="submit" class="btn btn-primary" onclick="return validateAndUpdateCart();">Cập nhật</button>
                    </td>
                }
                <td>
                    @Html.ActionLink("Xóa hàng", "DeleteProduct", "GioHang", new
                    {
                        MaSP =
                         sach.MaDT
                    }, new { @class = "btn btn-danger" })
                </td>
            </tr>
        }
        <tr style="font-weight:bold; text-align:right; color:red;">

            <td colspan="4">Tổng số lượng: @ViewBag.TongSL</td>
            <td colspan="5">Tổng tiền: @ViewBag.TongTien</td>
        </tr>
        <tr style="font-weight:bold; text-align:center;">
            <td colspan="9">

                @Html.ActionLink("ĐẶT HÀNG", "DatHang", null, new
                {
                    @class = "btn btn-primary"
                })

            </td>
        </tr>
    </tbody>
</table>-->
@*<a href="/GioHang/PaymentWithPayPal">paypal</a>*@

<!--<script>
    function updateCart(MaSP, SoLuong) {
        $.ajax({
            url: '@Url.Action("UpdateCart", "GioHang")',
            type: 'POST',
            data: { MaSP: MaSP, SoLuong: SoLuong },
            success: function () {
                // Refresh giỏ hàng sau khi cập nhật
                window.location.href = '@Url.Action("HienThiGioHang", "GioHang")';
            }
        });
    }
</script>-->
@* google font  *@
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300&display=swap" rel="stylesheet">

@* font awsome *@
<script src="https://kit.fontawesome.com/383abdf887.js" crossorigin="anonymous"></script>

<style>

    /* phần giỏ hàng */
    .giohang {
        font-family: 'Rowdies', cursive;
        font-weight: 400;
        height: 600px;
        background-color: #FF9A8B;
        background-image: linear-gradient(90deg, #FF9A8B 0%, #FF6A88 55%, #FF99AC 100%);
        padding: 1rem;
        color: cornsilk;
    }
    /*CSS CỦA CÁC TRANG QUẢN LÝ ĐẦU MỤC*/
    .headerOfQuanLy {
        display: flex;
        justify-content: space-around;
        align-items: center;
    }

    .headerTextOfQuanLy {
        letter-spacing: 2px;
        margin-top: 50px;
        text-align: center;
        font-weight: bold;
    }

    .createNew {
        /*font-weight: bold;*/
        display: block;
        width: 200px;
        font-size: 1.2rem;
        text-decoration: none;
        color: #ffffff;
        /*background: radial-gradient(#c31432, #240b36);*/
        background-color: #424242;
        border-radius: 10px;
        padding: 10px;
        margin: 20px auto;
    }

    /* css phần thanh toán thông tin đơn hàng nè */
    .thanhtoan {
        /*background-color: #3EECAC;
        background-image: linear-gradient(19deg, #3EECAC 0%, #EE74E1 100%);*/
    }

    .submit-thanhtoan {
        width: 600px;
        margin: 0 auto;
    }
</style>



<div class="giohang container">
    <h2 class="headerTextOfQuanLy">Giỏ Hàng </h2>
    <a class="createNew" style="text-align:center" href="@Url.Action("Index","SanPhams")">Thêm sản phẩm</a>


    @if (Model != null)
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Tên sản phẩm</th>
                    <th>Hình sản phẩm</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Thành tiền</th>

                </tr>
            </thead>
            <tbody>

                @foreach (var sp in Model)

                {

                    double total = sp.Soluong * (int)sp.Dongia;
                    int gia = (int)sp.Dongia;
                    <tr>
                        <td>
                            @sp.Ten
                        </td>
                        <td>
                            <img src="~/Image/@sp.AnhBia" height="60" width="60" />
                        </td>
                        <td>
                            @*@Html.DisplayFor(model => item._shopping_product.GiaSP)*@
                            @gia.ToString("#,##0").Replace(',', '.')&#8363
                        </td>
                        <td>
                            @using (Html.BeginForm("UpdateCart", "GioHang", new { MaSP = sp.MaDT }))
                            {
                                @*<input type="hidden" value="@sp.Masp" name="idPro" />*@

                                <input type="number" value="@sp.Soluong" name="SoLuong" />
                                <input type="submit" value="Cập nhật" />
                                @*@String.Format(@item._shopping_product.MaSP);*@
                            }
                        </td>
                        <td>
                            @total.ToString("#,##0").Replace(',', '.')&#8363
                        </td>
                        <td>
                            <a href=" @Url.Action("DeleteProduct","GioHang", new {MaSP=sp.MaDT})">
                                <i class="fa-solid fa-trash fa-beat fa-2xl" style="color: #195b6c;"></i>
                            </a>

                        </td>

                    </tr>
                  

                }
              


                @* hiển thị tổng tiền *@
                <tr>
                    <td colspan="6" style="text-align:right">
                        Tổng tiền: @ViewBag.TongTien.ToString("#,##0").Replace(',', '.') &#8363
                    </td>
                </tr>
                <tr style="font-weight:bold; text-align:center;">
                    <td colspan="9">
                        @if (Session["taikhoan"] != null)
                        {
                            @Html.ActionLink("ĐẶT HÀNG", "DatHang", null, new
                            {
                                @class = "btn btn-primary"
                            })
                        }
                        else if (Session["taikhoan"] == null)
                        {
                            @Html.ActionLink("ĐẶT HÀNG", "DatHang2", null, new{ @class = "btn btn-primary"})
                        }


                    </td>
                </tr>
            </tbody>

        </table>
    }

    else
    {
        <h3>Giỏ hàng rỗng ! xin mời tiếp tục mua hàng</h3>
    }


</div>

